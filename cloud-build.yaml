steps:
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args: [
    '-c',
    'docker pull gcr.io/$PROJECT_ID/pokkit-client:$COMMIT_SHA || exit 0'
  ]

- name: 'gcr.io/cloud-builders/docker'
  args: [
    'build',
    '-t', 'gcr.io/$PROJECT_ID/pokkit-client:$COMMIT_SHA',
    '--cache-from', 'gcr.io/$PROJECT_ID/pokkit-client:$COMMIT_SHA',
    './client'
  ]

- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args: [
   '-c',
    'docker pull gcr.io/$PROJECT_ID/pokkit-server:$COMMIT_SHA || exit 0'
  ]

- name: 'gcr.io/cloud-builders/docker'
  args: [
    'build',
    '-t', 'gcr.io/$PROJECT_ID/pokkit-server:$COMMIT_SHA',
    '--cache-from', 'gcr.io/$PROJECT_ID/pokkit-server:$COMMIT_SHA',
    './server'
  ]

images:
  - 'gcr.io/$PROJECT_ID/pokkit-client:$COMMIT_SHA'
  - 'gcr.io/$PROJECT_ID/pokkit-server:$COMMIT_SHA'
